script = '''
func = \result
    result is
        :ok "this is some value"
            "result is ok with some specific content"
        :ok contents
            "result is ok: {contents}"
        :blah
            "result is blah"
        :error desc
            "result is error: {desc}"
        x
            "nothing matches: {x}"

case1 = (:ok "this is some value") | func
case2 = (:ok "this is some other value") | func
case3 = :blah | func
case4 = (:error "this is an error") | func
case5a = :error | func
case5b = (:blah "nothing here") | func
case5c = :xyz | func

"Results are: case1: {case1}, case2: {case2}, case3: {case3}, case4: {case4}, case5a: {case5a}, case5b: {case5b}, case5c: {case5c}"
'''

[output]
result = "Results are: case1: result is ok with some specific content, case2: result is ok: this is some other value, case3: result is blah, case4: result is error: this is an error, case5a: nothing matches: :error, case5b: nothing matches: :blah(nothing here), case5c: nothing matches: :xyz"
type = "string"

[output.compiler]
bytecode = "[34, 4, 102, 117, 110, 99, 1, 1, 77, 35, 4, 109, 97, 105, 110, 36, 0, 1, 21, 0, 28, 18, 116, 104, 105, 115, 32, 105, 115, 32, 115, 111, 109, 101, 32, 118, 97, 108, 117, 101, 31, 2, 111, 107, 38, 1, 0, 0, 4, 102, 117, 110, 99, 21, 1, 28, 24, 116, 104, 105, 115, 32, 105, 115, 32, 115, 111, 109, 101, 32, 111, 116, 104, 101, 114, 32, 118, 97, 108, 117, 101, 31, 2, 111, 107, 38, 1, 0, 0, 4, 102, 117, 110, 99, 21, 2, 30, 4, 98, 108, 97, 104, 38, 1, 0, 0, 4, 102, 117, 110, 99, 21, 3, 28, 16, 116, 104, 105, 115, 32, 105, 115, 32, 97, 110, 32, 101, 114, 114, 111, 114, 31, 5, 101, 114, 114, 111, 114, 38, 1, 0, 0, 4, 102, 117, 110, 99, 21, 4, 30, 5, 101, 114, 114, 111, 114, 38, 1, 0, 0, 4, 102, 117, 110, 99, 21, 5, 28, 12, 110, 111, 116, 104, 105, 110, 103, 32, 104, 101, 114, 101, 31, 4, 98, 108, 97, 104, 38, 1, 0, 0, 4, 102, 117, 110, 99, 21, 6, 30, 3, 120, 121, 122, 38, 1, 0, 0, 4, 102, 117, 110, 99, 21, 7, 28, 20, 82, 101, 115, 117, 108, 116, 115, 32, 97, 114, 101, 58, 32, 99, 97, 115, 101, 49, 58, 32, 20, 1, 14, 28, 9, 44, 32, 99, 97, 115, 101, 50, 58, 32, 14, 20, 2, 14, 28, 9, 44, 32, 99, 97, 115, 101, 51, 58, 32, 14, 20, 3, 14, 28, 9, 44, 32, 99, 97, 115, 101, 52, 58, 32, 14, 20, 4, 14, 28, 10, 44, 32, 99, 97, 115, 101, 53, 97, 58, 32, 14, 20, 5, 14, 28, 10, 44, 32, 99, 97, 115, 101, 53, 98, 58, 32, 14, 20, 6, 14, 28, 10, 44, 32, 99, 97, 115, 101, 53, 99, 58, 32, 14, 20, 7, 14, 37, 35, 4, 102, 117, 110, 99, 20, 0, 28, 18, 116, 104, 105, 115, 32, 105, 115, 32, 115, 111, 109, 101, 32, 118, 97, 108, 117, 101, 31, 2, 111, 107, 17, 43, 0, 44, 28, 39, 114, 101, 115, 117, 108, 116, 32, 105, 115, 32, 111, 107, 32, 119, 105, 116, 104, 32, 115, 111, 109, 101, 32, 115, 112, 101, 99, 105, 102, 105, 99, 32, 99, 111, 110, 116, 101, 110, 116, 41, 0, 131, 32, 28, 2, 111, 107, 17, 43, 0, 25, 33, 21, 1, 28, 14, 114, 101, 115, 117, 108, 116, 32, 105, 115, 32, 111, 107, 58, 32, 20, 1, 14, 41, 0, 97, 20, 0, 30, 4, 98, 108, 97, 104, 17, 43, 0, 19, 28, 14, 114, 101, 115, 117, 108, 116, 32, 105, 115, 32, 98, 108, 97, 104, 41, 0, 66, 32, 28, 5, 101, 114, 114, 111, 114, 17, 43, 0, 28, 33, 21, 1, 28, 17, 114, 101, 115, 117, 108, 116, 32, 105, 115, 32, 101, 114, 114, 111, 114, 58, 32, 20, 1, 14, 41, 0, 26, 20, 0, 21, 1, 28, 17, 110, 111, 116, 104, 105, 110, 103, 32, 109, 97, 116, 99, 104, 101, 115, 58, 32, 20, 1, 14, 37]"
bytecode_length = 545
disassembled = """
0 \tfunction signature (name: func) (local count: 1) (function position: 333)

9 \t=== function chunk: main ===
15 \tfunction (function index: 0) (params: 1)
18 \tset_value (index: 0)
20 \tpush_string (value: 'this is some value')
40 \tpush_tag (value: ':ok')
44 \tcall func (is_global: 0) (arg count: 1, function index: 0)
53 \tset_value (index: 1)
55 \tpush_string (value: 'this is some other value')
81 \tpush_tag (value: ':ok')
85 \tcall func (is_global: 0) (arg count: 1, function index: 0)
94 \tset_value (index: 2)
96 \tpush_simple_tag (value: ':blah')
102 \tcall func (is_global: 0) (arg count: 1, function index: 0)
111 \tset_value (index: 3)
113 \tpush_string (value: 'this is an error')
131 \tpush_tag (value: ':error')
138 \tcall func (is_global: 0) (arg count: 1, function index: 0)
147 \tset_value (index: 4)
149 \tpush_simple_tag (value: ':error')
156 \tcall func (is_global: 0) (arg count: 1, function index: 0)
165 \tset_value (index: 5)
167 \tpush_string (value: 'nothing here')
181 \tpush_tag (value: ':blah')
187 \tcall func (is_global: 0) (arg count: 1, function index: 0)
196 \tset_value (index: 6)
198 \tpush_simple_tag (value: ':xyz')
203 \tcall func (is_global: 0) (arg count: 1, function index: 0)
212 \tset_value (index: 7)
214 \tpush_string (value: 'Results are: case1: ')
236 \tget_value (index: 1)
238 \tstr_concat
239 \tpush_string (value: ', case2: ')
250 \tstr_concat
251 \tget_value (index: 2)
253 \tstr_concat
254 \tpush_string (value: ', case3: ')
265 \tstr_concat
266 \tget_value (index: 3)
268 \tstr_concat
269 \tpush_string (value: ', case4: ')
280 \tstr_concat
281 \tget_value (index: 4)
283 \tstr_concat
284 \tpush_string (value: ', case5a: ')
296 \tstr_concat
297 \tget_value (index: 5)
299 \tstr_concat
300 \tpush_string (value: ', case5b: ')
312 \tstr_concat
313 \tget_value (index: 6)
315 \tstr_concat
316 \tpush_string (value: ', case5c: ')
328 \tstr_concat
329 \tget_value (index: 7)
331 \tstr_concat
332 \tret

333 \t=== function chunk: func ===
339 \tget_value (index: 0)
341 \tpush_string (value: 'this is some value')
361 \tpush_tag (value: ':ok')
365 \teq
366 \tjump if false (offset: 44, to byte 413)
369 \tpush_string (value: 'result is ok with some specific content')
410 \tjump (offset: 131, to byte 544)
413 \tget_tag_name
414 \tpush_string (value: 'ok')
418 \teq
419 \tjump if false (offset: 25, to byte 447)
422 \tget_tag_payload
423 \tset_value (index: 1)
425 \tpush_string (value: 'result is ok: ')
441 \tget_value (index: 1)
443 \tstr_concat
444 \tjump (offset: 97, to byte 544)
447 \tget_value (index: 0)
449 \tpush_simple_tag (value: ':blah')
455 \teq
456 \tjump if false (offset: 19, to byte 478)
459 \tpush_string (value: 'result is blah')
475 \tjump (offset: 66, to byte 544)
478 \tget_tag_name
479 \tpush_string (value: 'error')
486 \teq
487 \tjump if false (offset: 28, to byte 518)
490 \tget_tag_payload
491 \tset_value (index: 1)
493 \tpush_string (value: 'result is error: ')
512 \tget_value (index: 1)
514 \tstr_concat
515 \tjump (offset: 26, to byte 544)
518 \tget_value (index: 0)
520 \tset_value (index: 1)
522 \tpush_string (value: 'nothing matches: ')
541 \tget_value (index: 1)
543 \tstr_concat
544 \tret
"""

[output.vm]
bytes_read = 949
instructions_executed = 196
jumps_performed = 22
max_stack_height = 11
stack_allocations = 142
