script = '''
x = 1
y = 2

square = \v
    v * v

z = 3

match = \v
    x = 2
    res = v + x is
       	3
            y = 4
            v + y
        4
           	z = v + x + 5
           	z | square
        captured
           	w = 6
           	w2 = 7
           	captured + x + w + w2
    val = 8
    res + val

w = 4

"result is {1 | match}, {2 | match} and {3 | match}"
'''

[output]
result = "result is 13, 89 and 28"
type = "string"

[output.compiler]
bytecode = "[35, 6, 115, 113, 117, 97, 114, 101, 1, 0, 139, 35, 5, 109, 97, 116, 99, 104, 1, 0, 153, 36, 4, 109, 97, 105, 110, 27, 0, 0, 0, 1, 21, 0, 27, 0, 0, 0, 2, 21, 1, 37, 0, 1, 21, 2, 27, 0, 0, 0, 3, 21, 3, 37, 1, 1, 21, 4, 27, 0, 0, 0, 4, 21, 5, 28, 10, 114, 101, 115, 117, 108, 116, 32, 105, 115, 32, 27, 0, 0, 0, 1, 39, 1, 0, 4, 5, 109, 97, 116, 99, 104, 14, 28, 2, 44, 32, 14, 27, 0, 0, 0, 2, 39, 1, 0, 4, 5, 109, 97, 116, 99, 104, 14, 28, 5, 32, 97, 110, 100, 32, 14, 27, 0, 0, 0, 3, 39, 1, 0, 4, 5, 109, 97, 116, 99, 104, 14, 38, 36, 6, 115, 113, 117, 97, 114, 101, 20, 0, 20, 0, 3, 38, 36, 5, 109, 97, 116, 99, 104, 27, 0, 0, 0, 2, 21, 1, 20, 0, 20, 1, 0, 21, 2, 20, 2, 27, 0, 0, 0, 3, 17, 44, 0, 15, 27, 0, 0, 0, 4, 21, 2, 20, 0, 20, 2, 0, 42, 0, 72, 20, 2, 27, 0, 0, 0, 4, 17, 44, 0, 29, 20, 0, 20, 1, 0, 27, 0, 0, 0, 5, 0, 21, 2, 20, 2, 39, 1, 1, 2, 6, 115, 113, 117, 97, 114, 101, 42, 0, 32, 20, 0, 20, 1, 0, 21, 2, 27, 0, 0, 0, 6, 21, 3, 27, 0, 0, 0, 7, 21, 4, 20, 2, 20, 1, 0, 20, 3, 0, 20, 4, 0, 21, 3, 27, 0, 0, 0, 8, 21, 4, 20, 3, 20, 4, 0, 38]"
bytecode_length = 287
disassembled = """
0 \tfunction signature (name: square) (local count: 1) (function position: 139)
11 \tfunction signature (name: match) (local count: 1) (function position: 153)

21 \t=== function chunk: main ===
27 \tpush_integer (value: 1)
32 \tset_value (index: 0)
34 \tpush_integer (value: 2)
39 \tset_value (index: 1)
41 \tfunction (function index: 0) (params: 1)
44 \tset_value (index: 2)
46 \tpush_integer (value: 3)
51 \tset_value (index: 3)
53 \tfunction (function index: 1) (params: 1)
56 \tset_value (index: 4)
58 \tpush_integer (value: 4)
63 \tset_value (index: 5)
65 \tpush_string (value: 'result is ')
77 \tpush_integer (value: 1)
82 \tcall match (is_global: 0) (arg count: 1, function index: 4)
92 \tstr_concat
93 \tpush_string (value: ', ')
97 \tstr_concat
98 \tpush_integer (value: 2)
103 \tcall match (is_global: 0) (arg count: 1, function index: 4)
113 \tstr_concat
114 \tpush_string (value: ' and ')
121 \tstr_concat
122 \tpush_integer (value: 3)
127 \tcall match (is_global: 0) (arg count: 1, function index: 4)
137 \tstr_concat
138 \tret

139 \t=== function chunk: square ===
147 \tget_value (index: 0)
149 \tget_value (index: 0)
151 \tint_mult
152 \tret

153 \t=== function chunk: match ===
160 \tpush_integer (value: 2)
165 \tset_value (index: 1)
167 \tget_value (index: 0)
169 \tget_value (index: 1)
171 \tint_add
172 \tset_value (index: 2)
174 \tget_value (index: 2)
176 \tpush_integer (value: 3)
181 \teq
182 \tjump if false (offset: 15, to byte 200)
185 \tpush_integer (value: 4)
190 \tset_value (index: 2)
192 \tget_value (index: 0)
194 \tget_value (index: 2)
196 \tint_add
197 \tjump (offset: 72, to byte 272)
200 \tget_value (index: 2)
202 \tpush_integer (value: 4)
207 \teq
208 \tjump if false (offset: 29, to byte 240)
211 \tget_value (index: 0)
213 \tget_value (index: 1)
215 \tint_add
216 \tpush_integer (value: 5)
221 \tint_add
222 \tset_value (index: 2)
224 \tget_value (index: 2)
226 \tcall square (is_global: 1) (arg count: 1, function index: 2)
237 \tjump (offset: 32, to byte 272)
240 \tget_value (index: 0)
242 \tget_value (index: 1)
244 \tint_add
245 \tset_value (index: 2)
247 \tpush_integer (value: 6)
252 \tset_value (index: 3)
254 \tpush_integer (value: 7)
259 \tset_value (index: 4)
261 \tget_value (index: 2)
263 \tget_value (index: 1)
265 \tint_add
266 \tget_value (index: 3)
268 \tint_add
269 \tget_value (index: 4)
271 \tint_add
272 \tset_value (index: 3)
274 \tpush_integer (value: 8)
279 \tset_value (index: 4)
281 \tget_value (index: 3)
283 \tget_value (index: 4)
285 \tint_add
286 \tret
"""

[output.vm]
bytes_read = 393
instructions_executed = 125
jumps_performed = 5
max_stack_height = 14
stack_allocations = 86
